<%inherit file="/base.html" />
<%def name="sel(name,lst,val)">
<select name='${name}'>
% for st in lst:
<option value='${st}' \
% if st==val:
selected=1 \
% endif
>${st}</option>
% endfor
</select>\
</%def>
<%def name="content()">
<h2>Task ${task['story']}</h2>
<a href="${upr}/task/new/${task['story']}" accesskey='s'><b>s</b>ubtask</a> :: \
<a href="${upr}/task/${task['id']}">permalink</a> :: \
<a href="${url}/s/${task['id']}">static render</a> :: \
% if '/' in task['story']:
<a href="${upr}/task/${"/".join(task['story'].split('/')[0:-1])}" accesskey="u">one <b>u</b>p</a> :: \
% endif
<a href="${upr}/">home</a><br />
% if msg:
<div class='msg'>${msg}</div>
% endif
<small>created ${task['created at']}</small>
<form method='post'>
% if task.get('under'):
<h4>under ${task.get('under')}</h4>
<input type='hidden' name='under' value="${task.get('under')}" />
% endif
<input type='hidden' name='id' value="${task['story']}" />
<dl>
<dt>Summary</dt>
<dd><input id='summary' class='summary' type='text' name="summary" value="${task['summary']}" /></dd>

<dt>Tags</dt>
<dd>
  % for tag in task['tags']:
  <input type='checkbox' name="tag-${tag}" checked=1 value=1 /> ${tag} ; 
  % endfor
  add tag(s): <input type='text' name='tag-new' value="" />
</dd>
<dt>iteration</dt>
<dd><a href="${upr}/iteration/${task['iteration']}">${task['iteration']}</a>
 ; move to ${self.sel('iteration',iterations,task['iteration'])}
</dd>

<dt>status</dt>
<dd>
${self.sel('status',statuses,task['status'])}
</dd>

<dt>assignee</dt>
<dd><a href="${upr}/assignments/${task['assigned to']}">${task['assigned to']}</a> ;
change to ${self.sel('assignee',participants,task['assigned to'])}
</se
</dd>

<dt>creator</dt>
<dd><a href="${upr}/assignments/${task['created by']}">${task['created by']}</a></dd>

</dl>

<h3>Edit</h3>
<textarea class='content' name='unstructured'>${task['unstructured'].decode('utf-8')}</textarea>
% if task['id']:
<input type='submit' value='Update' />
% else:
<input name='create' type='submit' value='Create' />
% endif
</form>

% if len(children):
<h3>Sub tasks</h3>
${self.list_tasks(children)}
% endif

% if task.get('person_hours'):
<h3>Time tracking</h3>
<table>
<thead>
<tr>
  <th>person</th>
  <td>last tracked</th>
  <td>hours</th>
</tr>
</thead>
<tbody>
% for ph in task['person_hours']:
<tr>
<td>${ph[0]}</td>
<td>${ph[1]['last_tracked']}</td>
<td class='ralign'>${"%4.1f"%ph[1]['hours']}</td>
</tr>
% endfor
</tbody>
</table>
% endif

## <h3>Render</h3>
## <iframe class='rndr' src=""></iframe>

<script type='text/javascript'>
window.onload = function() {
document.getElementById('summary').focus();
}
</script>
</%def>
